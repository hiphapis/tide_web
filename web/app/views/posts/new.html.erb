<div class="content_title">
  <div class="title">POST NEW ARTICLE</div>
</div>

<div class="edit_form">
  <%= semantic_form_for @post do |f| %>

    <%= f.inputs do %>
      <%= f.input :category, :include_blank => false, :label => "카테고리" %>
      <%= f.input :source_url %>

      <%= f.input :title %>
      <%= f.input :body %>
      
      <li>
        <label>TAG</label>
        <div class="input_group">
          <div class="tag_insert_form">
            <div class="exist_tag">
              <%= select_tag :exist_tag, options_from_collection_for_select(Tag.order("name"), :name, :name) %>
              <%= link_to_function "+add", "addNewTag($('#exist_tag').val())" %>
            </div>
            <div class="new_tag">
              <label for="new_tag">or Type:</label>
              <%= text_field_tag :new_tag, nil, :autocomplete => "off" %>
              <%= link_to_function "+add", "addNewTag()" %>
            </div>
          </div>
          <ul id="tags" class="tags_form">
            <%= f.fields_for :taggings do |tag_form| %>
              <li class="tag">
                <div><%= tag_form.object.name %><%= link_to_function "x", "removeTag(this)" %></div>
                <input class='remove' name='post[taggings_attributes][][_destroy]' type='hidden' value='' />
                <input name='post[taggings_attributes][][name]' type='hidden' value='<%= tag_form.object.name %>' />
              </li>
            <% end %>
          </ul>
        </div>
      </li>
    <% end %>
    
    <%= f.buttons :class => "right_buttons" do %>
      <%= f.commit_button "DONE" %>
    <% end %>
    
    <%= f.hidden_field :user_id, :value => current_user.try(:id) %>
    
  <% end %>
</div>


<script>

function removeTag(e) {
  var c = $(e).parent();
  c.next().val("1");
  c.parent().hide();
}

function addNewTag(val) {
  var tag = val;
  if (!tag) tag = $("#new_tag").val();
  if (tag.length <= 1) {
    alert("내용이 없습니다.");
    return;
  }
  var html = "\
  <li class='tag'> \
  <div>" + tag + "<a href='#' onclick='removeTag(this);return false;'>x</a></div> \
  <input class='remove' name='post[taggings_attributes][][_destroy]' type='hidden' value='' /> \
  <input name='post[taggings_attributes][][name]' type='hidden' value='" + tag + "' /> \
  </li>";
  $("#tags").prepend(html);
  $("#new_tag").val("");
}

</script>
